<!doctype html>
<html>
<head>
    <style>
        .bar {
            fill: steelblue;
        }

        .bar2 {
            fill: aquamarine;
        }

        .bar3 {
            fill: yellow;
        }

        .line {
  fill: none;
  stroke: steelblue;
  stroke-width: 2px;
}
    </style>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.4/lodash.min.js"></script>
  <script src="https://unpkg.com/d3-simple-slider@0.1.2/build/d3-simple-slider.js"></script>
  
<body>
<svg width="1200" height="600"></svg>
<p id="value">Move me</p>
  <div id="value"></div>
  <a id="setValue" href="#">Set value</a>
  <a id="changeWidth" href="#">Change width</a>
  
<script>

    var svg = d3.select("svg"),
        margin = 200,
        width = svg.attr("width") - margin,
        height = svg.attr("height") - margin

    svg.append("text")
       .attr("transform", "translate(100,0)")
       .attr("x", 50)
       .attr("y", 50)
       .attr("font-size", "24px")
       .text("Bevolking van Belgie")


       function test() {


           svg.selectAll("*").remove();

    var xScale = d3.scaleBand().range([0, width]).padding(0.4),
        yScale = d3.scaleLinear().range([height, 0]),
        yScale2 = d3.scaleLinear().range([height, 0]);
        yScale3 = d3.scaleLinear().range([height, 0]);

    var g = svg.append("g")
               .attr("transform", "translate(" + 100 + "," + 100 + ")");


    // define the line
    var line = d3.line()
    .x(function(d, i) { return xScale(d.year); }) // set the x values for the line generator
    .y(function(d) { return yScale(d.population) }) // set the y values for the line generator 
    .curve(d3.curveMonotoneX) // apply smoothing to the line

    d3.csv("data.csv", function(error, data) {
        if (error) {
            throw error;
        }
        xScale.domain(data.map(function(d) { return d.year; }));
        yScale.domain([0, d3.max(data, function(d) { return d.population*sliderVals(); ; })]);
        yScale2.domain([0, d3.max(data, function(d) { return d.geboorte*sliderVals(); ; })]);
        yScale3.domain([0, d3.max(data, function(d) { return d.sterfte*sliderVals(); ; })]);

        //maak bottom
        g.append("g")
         .attr("transform", "translate(0," + height + ")")
         .call(d3.axisBottom(xScale))
         .append("text")
         .attr("y", height - 250)
         .attr("x", width - 100)
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("Year");

        g.append("g")
         .call(d3.axisLeft(yScale).tickFormat(function(d){
            console.log(d);
             return  d;
         })
         .ticks(20))
         .append("text")
         .attr("transform", "rotate(-90)")
         .attr("y", 6)
         .attr("dy", "-5.1em")
         .attr("text-anchor", "end")
         .attr("stroke", "black")
         .text("Aantal mensen");

        g.selectAll(".bar")
         .data(data)
         .enter().append("rect")
         .attr("class", "bar")
         .attr("x", function(d) { return xScale(d.year); })
         .attr("y", function(d) { return yScale(d.population); })
        // .attr("y", function(d) { return yScale(d.geboorte); })
         .attr("width", xScale.bandwidth()/3)
         .attr("height", function(d) { return height - yScale(d.population); });

         g.selectAll(".bar2")
         .data(data)
         .enter().append("rect")
         .attr("class", "bar2")
         .attr("x", function(d) { return xScale(d.year)+xScale.bandwidth()/3; })
         .attr("y", function(d) { return yScale(d.geboorte); })
         .attr("width", xScale.bandwidth()/3)
         .attr("height", function(d) { return height - yScale(d.geboorte); });

         g.selectAll(".bar3")
         .data(data)
         .enter().append("rect")
         .attr("class", "bar3")
         .attr("x", function(d) { return xScale(d.year)+xScale.bandwidth()/3*2; })
         .attr("y", function(d) { return yScale(d.sterfte); })
         .attr("width", xScale.bandwidth()/3)
         .attr("height", function(d) { return height - yScale(d.sterfte); });

         g.selectAll(".bar4")
         .data(data)
         .enter().append("rect")
         .attr("class", "bar4")
         .attr("x", function(d) { return xScale(d.year)+xScale.bandwidth()/3*2; })
         .attr("y", function(d) { return yScale(d.immigration); })
         .attr("width", xScale.bandwidth()/3)
         .attr("height", function(d) { return height - yScale(d.sterfte); });

         g.append("path")
    .datum(data) // 10. Binds data to the line 
    .attr("class", "line") // Assign a class for styling 
    .attr("d", line); // 11. Calls the line generator 


    });

}
    var data = [0.5, 1, 3];
    var sliderVal;
    var slider = d3Slider.sliderHorizontal()
      .domain(d3.extent(data))
      .width(300)
      .tickFormat(d3.format('.2%'))
      .ticks(5)
      .default(0.015)
      .on('onchange', val => {
        d3.select("p#value").text(d3.format('.2%')(val));
      })
      .on('onchange', val => {
        sliderVal = (d3.format('.2')(val));
        sliderVals();
        console.log(sliderVals());
        test();
      });

    function sliderVals(){
        return sliderVal;
    }

    

    var d = d3.select("div#value").append("svg")
      .attr("width", 500)
      .attr("height", 100)
      .append("g")
      .attr("transform", "translate(30,30)");

    d.call(slider);

    d3.select("a#setValue").on("click", () => slider.value(0.01));


    d3.select("a#changeWidth").on("click", () => d.call(slider.width(Math.floor(Math.random() * 500) + 200)));
  </script>
</body>
</html>